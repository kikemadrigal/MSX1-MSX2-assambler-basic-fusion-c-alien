30DEFINTA-Z:DIMP(15):Z=USR(1)
40_TURBOON(P(),Z)
50DIMF$(1)
51DIMdx(4),dy(4),di(4),dv(4),dl(4),dp(4),ds(4),da(4)
55DIMex(3),ey(3),ev(3),el(3),es(3),ep(3),ec(3),ee(3),et(3),ea(3)
60mc=0:ma=0:ms=0:mu=0:mw=6*32
90pg=2:md=&h8000
100px=0:py=18*8:pn=0:m=0:pw=8:ph=16:pv=2:pl=2:pj=0:pa=0:pd=0:pe=5
110p1=0:p2=1:p3=2:p4=3
120pp=0:ps=0
130dm=4:dn=0:dd=0:ds=8:dc=6:dp=0:dw=2:dh=2
140em=3:en=0:es=11
150bo=0:bx=0:bw=24:bh=16:bz=0:bi=0:by=0:be=100:bv=1:bd=3:ba=0:bb=0
160se=0:fx=0
170strig(0)on:onstriggosub11500
180gosub7000
210gosub14000
220remnada
230P(0)=0:P(1)=&h41:Z=USR(58)
240gosub13000
250P(0)=0:P(1)=&h44:Z=USR(58)
400gosub6000
420'se=1:gosub7100
1000gosub2000
1020gosub4000
1040ifbo=1thengosub12950
1050ifpd=3orpd=0orpd=1orpd=2thenputsprite0,(px,py),,p1elseifpd=7orpd=5thenputsprite0,(px,py),,p3
1060gosub11700
1070gosub12800
1080ifpe<=0thengosub10300:goto60
1090ifmu=1thenputsprite0,(0,212),,p1:px=8:py=18*8:ma=ma+1:mc=0:mu=0:ms=0:gosub13000:gosub6000:ifma>4thengosub14100:goto60
1110'fori=0to1000:nexti
1900goto1000
2000pn=px:pm=py
2010onstick(0)gosub2200,2400,2600,2000,2000,2000,3400,3600
2190return
2200ifpa=0andt5>=tfthenpo=py:pa=1
2290return
2400ifpa=0andt5>=tfthenpo=py:pa=1
2410px=px+pv:pd=3
2420ifpxmod8=0thenswapp1,p2
2490return
2600px=px+pv:pd=3
2610ifpxmod8=0thenswapp1,p2
2690return
3400px=px-pv:pd=7
3410ifpxmod8=0thenswapp3,p4
3490return
3600ifpa=0andt5>=tfthenpo=py:pa=1
3610px=px-pv:pd=7
3620ifpxmod8=0thenswapp3,p4
3690return
4000ifwc=0andbo=0thenputsprite20,(256-16,16),2,34
4010'ifmc>=200thenreturn
4020ifpx>256-8thenifwc=0thenputsprite0,(0,212),,p1:putsprite20,(0,212),0,33:gosub12700:gosub13600:py=18*8:px=0:ms=ms+1:gosub13800:gosub6000elsepx=31*8:putsprite20,(256-16,16),6,33
4030ifpx<0thenpx=0
4040ifpy>180thengosub10400:'elseifpymod8<>0thenpy=py/8
4050ifpd=3thentx=(px)/8+(ms*32)elsetx=(px+8)/8+(ms*32)
4055ifpymod8=0thenty=(py/8)+1:ifpx<=0thentx=0:ifpy<=0thenty=0
4060t0=vpeek(md+tx+((ty)*mw))
4070ift0<tcandt0>=1thenvpokemd+tx+(ty*mw),tw:wc=wc-1:gosub6000:fx=3:gosub7400:ifma=0thenline(px,py+8)-(px+8,py+14),11,bfelseifma=1thenline(px,py+6)-(px+8,py+14),14,bfelseline(px,py+6)-(px+8,py+14),9,bf
4080ift0=tdthengosub10400:fx=1:gosub7400
4090ift0=tethenmu=1
4095t1=vpeek(md+tx+((ty-1)*mw))
4100t3=vpeek(md+tx+1+((ty)*mw))
4110t5=vpeek(md+tx+((ty+1)*mw))
4120t7=vpeek(md+(tx-1)+((ty)*mw))
4125ift1>=tfandpa=1thenpy=py+pl:pa=0
4130ift3>=tfandpa=0thenpx=px-pv
4140ift7>=tfandpa=0thenpx=px+pv
4150ift5>=tfandpl<0thenpa=0:pl=-pl
4160ifpa=1thenpy=py-pl
4170ifpa=1andpy<po-24thenpl=-pl
4180ifpa=1andpy>pothenpl=-pl:pa=0
4190ifpa=0andt5<tfthenpy=py+pl
4290return
6000line(0,184)-(256,212),1,bf
    6010 preset (10,186):F$(0)="Capturas que faltan: "+str$(wc): Z=USR(60)
    6020 preset (10,194):F$(0)="Level: "+str$(ma)+"-"+str$(ms)+" vidas: "+str$(pe): Z=USR(60)
    6030 if bo=1 then preset (10,202):F$(0)="Energia boss: "+str$(be): Z=USR(60)
6090return
6100 preset (0,20):F$(0)="en "+str$(en)+" t "+str$(t): Z=USR(60)
6140preset(0,60):F$(0)="ex3"+str$(ex(3))+"ec3"+str$(ec(3))+"et3"+str$(et(3))+"ea3"+str$(ea(3)):Z=USR(60)
6190return
7000F$(0)="UWOL_P.z80":E=USR(31)
7010f=P(0):P(2)=5:P(3)=0:P(4)=5737:P(6)=0:E=USR(33)
7020P(0)=f:E=USR(32)
7030P(0)=5:P(1)=&H8000:E=USR(59)
7040P(0)=1:P(1)=5:P(2)=&H8006:E=USR(66)
7090return
7100P(0)=5:P(1)=&H8003:P(2)=se*256:E=USR(59)
7190return
7200P(0)=5:P(1)=&H8009:E=USR(59)
7290return
7400P(0)=5:P(1)=&H800C:P(3)=fx*256:E=USR(59)
7490return
    10300 cls:gosub 12700:put sprite 0,(0,212),,p1:preset (10,30): F$(0)="Game over, otra s/n?": Z=USR(60)
10310ifinkey$<>"s"andinkey$<>"S"thengoto10310
10320return
10400ifbo=1thenba=0:bb=240:putsprite9,(ba,bb),,18
10405py=18*8:px=0:putsprite0,(px,py),,p1
10410pe=pe-1
10415pa=0:ifpl<=0thenpl=-pl
10420gosub6000
10430fx=3:gosub7400
10490return
11500ifdn>=dmthenreturnelsedn=dn+1
11510dx(dn)=px+8:dy(dn)=py+8
11520di(dn)=pd
11530dv(dn)=8:dl(dn)=2
11540dp(dn)=dn
11550ds(dn)=8
11551da(dn)=1
11560fx=2:gosub7400
11580return
11600'ifdn<=0thenreturn
11601putspritedp(dd),(0,212),,ds(dd)
11605dx(dd)=dx(dn):dy(dd)=dy(dn):dp(dd)=dp(dn)
11610da(dd)=0
11620'dp(dd)=dn-1
11650dn=dn-1
11690return
11700ifdn<=0thenreturn
11710fori=1todn
11715dx=dx(i)/8+(ms*32):dy=(dy(i)/8)
11716d0=vpeek(md+dx+((dy)*mw))
11717ifd0>=tfthendd=i:gosub11600:fx=2:gosub7400
11720ifdi(i)=1ordi(i)=2ordi(i)=3thendx(i)=dx(i)+dv(i)elsedx(i)=dx(i)-dv(i)
11721ifdi(i)=5thendy(i)=dy(i)+dl(i)
11730ifda(dn)=1thenputspritedp(i),(dx(i),dy(i)),dc,ds(i)
11740ifdx(i)<0ordx(i)>256thendd=i:gosub11600
11741ifdy(i)>212thendd=i:gosub11600
11742'ifbo=1anddt(i)=1thenifpx<dx(i)+dwandpx+8>dx(i)andpy<dy(i)+dhand16+py>dy(i)thengosub10400:gosub11600:beep
11742ifbo=1thenifdx(i)<bx+bwanddx(i)+dw>bxanddy(i)<by+bhanddy(i)+dh>bythenbe=be-10:dd=i:gosub11600:gosub6000
11750nexti
11790return
12000ifen>=emthenreturnelseen=en+1
12010et(en)=0
12020ex(en)=0:ey(en)=0
12030ev(en)=1:el(en)=8
12040es(en)=9:ep(en)=9+en
12050ec(en)=0
12060ee(en)=3
12070ea(en)=1
12090return
12600ifen<=0thenreturn
12600'ev(ed)=ev(en-1):el(ed)=el(en-1):es(ed)=es(en-1):ep(ed)=ep(en-1):ec(ed)=ec(en-1):ee(ed)=ee(en-1):et(ed)=et(en-1)
12601ea(ed)=0
12610ex(ed)=0:ey(ed)=212:putspriteep(ed),(ex(ed),ey(ed)),,es(ed)
12650'nada'
12660return
12700fori=1toen
12710ed=i:gosub12600
12720nexti
12725en=0
12790return
12800ifen<=0thenreturn
12805t=time/60:ift>5thentime=0:gosub12000:ex(en)=255:ey(en)=rnd(1)*(170-100)+100:et(en)=rnd(1)*(5-3)+3:ea(en)=1:fx=1:gosub7400
12810fori=1toen
12820ifea(i)=1thenec(i)=ec(i)+1:ex(i)=ex(i)-ev(i):putspriteep(i),(ex(i),ey(i)),,es(i):ifec(i)>=10thenec(i)=0
12830ifet(i)=0andex(i)mod25=0thenev(i)=-ev(i)
12835ifet(i)=1andex(i)mod25=0thenev(i)=-ev(i)
12850ifet(i)=0andea(i)=1thenifev(i)>0thenifec(i)>4thenes(i)=11elsees(i)=12
12860ifet(i)=0andea(i)=1thenifev(i)<=0thenifec(i)>4thenes(i)=9elsees(i)=10
12861ifet(i)=1andea(i)=1thenifev(i)>0thenifec(i)>4thenes(i)=13elsees(i)=14
12862ifet(i)=1andea(i)=1thenifev(i)<=0thenifec(i)>4thenes(i)=15elsees(i)=16
12863ifet(i)=3andea(i)=1thenifev(i)>0thenifec(i)>4thenes(i)=25elsees(i)=26
12865ifet(i)=4andea(i)=1thenifev(i)>0thenifec(i)>4thenes(i)=29elsees(i)=30
12867ifex(i)=1thenifex(i)<=8thened=i:gosub12600:fx=3:gosub7400
12880ifpx<ex(i)+16andpx+16>ex(i)andpy<ey(i)+16and16+py>ey(i)thengosub10400:ed=i:gosub12600
12890forw=1todn
12891ifdx(w)<ex(i)+16anddx(w)+15>ex(i)anddy(w)<ey(i)+16and2+dy(w)>ey(i)thendd=w:gosub11600:ee(i)=ee(i)-1:ifee(i)<=0thened=i:gosub12600:fx=6:gosub7400
12892nextw
12895nexti
12899return
12950bi=bx:bz=by
12955ifbn=0thenby=by-bv:line(bx,bz)-(bx+bw,bz+bh),11,bf:copy(48,64)-(64,80),2to(bx,by),0,tpset:ifby<100orby>154thenbv=-bv
12956ifbn=1thenbx=bx-bv:bw=48:bh=32:line(bx,bz)-(bx+bw,bz+bh),14,bf:copy(64,64)-(112,96),2to(bx,by),0,tpset:ifbx<100orbx>154thenbv=-bv
12956ifbn=2thenbx=bx-bv:bw=48:bh=32:line(bx,bz)-(bx+bw,bz+bh),6,bf:copy(160,64)-(184,96),2to(bx,by),0,tpset:iftime/60>8thenbx=rnd(1)*256:by=rnd(1)*200
12960ifbe<=0thenbo=0:line(bx,by)-(bx+bw,bz+bh),11,bf:copy(te*8,0*8)-((te*8)+8,(0*8)+8),2to(25*8,21*8),0,tpset:putsprite9,(0,212),,18:vpokemd+(mc-32)+25+(21*mw),te
12970ifbo=1andtime/60>8thentime=0:ba=bx:bb=by
12980ifbo=1thenba=ba-8:ifba<1thenputsprite9,(0,212),,18:ba=0elseputsprite9,(ba,bb),,18
12999return
13000ifma=0thenF$(0)="tilemap0.bin":E=USR(31):P(2)=0:P(3)=&H8000:P(4)=&h4000:E=USR(34):E=USR(32)
13010ifma=1thenF$(0)="tilemap1.bin":E=USR(31):P(2)=0:P(3)=&H8000:P(4)=&h4000:E=USR(34):E=USR(32)
13020ifma=2thenF$(0)="tilemap2.bin":E=USR(31):P(2)=0:P(3)=&H8000:P(4)=&h4000:E=USR(34):E=USR(32)
13195gosub13800:gosub13600
13199return
13600ifmc>6*32thenreturn
13603fori=0to31
13610copy(8,0)-(256,184),0to(0,0),0,pset
13620forf=0to23-1
13630tn=vpeek(md+mc+f*mw):tn=tn+2
13635forw=0to8
13636iftn>=w*32andtn<(w+1)*32thencopy((tn-(w*32))*8,w*8)-(((tn-(w*32))*8)+8,(w*8)+8),pgto(31*8,f*8),0,tpset
13637nextw
13720nextf
13725mc=mc+1
13730nexti
13740return
13800ifma=0andms=0thentc=26:tf=160:te=28:tw=80:td=42:wc=3:gosub12000:ex(en)=12*8:ey(en)=17*8:et(en)=0:gosub12000:ex(en)=28*8:ey(en)=20*8:et(en)=1
13810ifma=0andms=1thenwc=3:gosub12000:ex(en)=(17*8):ey(en)=17*8
13820ifma=0andms=2thenwc=3:gosub12000:ex(en)=23*8:ey(en)=20*8
13830ifma=0andms=3thenwc=3:gosub12000:ex(en)=21*8:ey(en)=11*8
13840ifma=0andms=4thenwc=3:gosub12000:ex(en)=26*8:ey(en)=20*8
13850ifma=0andms=5thengosub12800:bo=1:bn=0:be=100:bx=150:by=120:gosub6000
    13860 if ma=1 and ms=0 then cls:preset(20,212/2):F$(0)="Level 2, Cuartel general, pulse una tecla":Z=USR(60):wc=3:tc=26:tf=160:te=28:tw=80:td=42:gosub 12000:ex(en)=(14*8):ey(en)=17*8
13910ifma=1andms=5thengosub12800:bo=1:bn=1:be=100:bx=150:by=120:gosub6000
    13920 if ma=2 and ms=0 then cls:preset(20,212/2):F$(0)="Level 3, Lanzadera":Z=USR(60):gosub 12000:ex(en)=(10*8):ey(en)=10*8:wc=3:tc=26:tf=160:te=26:tw=80:
13970ifma=2andms=5thengosub12800:bo=1:bn=2:be=100:bx=150:by=120:gosub6000
13990return
14000L=&h69ff:F$(0)="menu.sc5":Z=USR(31):P(2)=0:P(3)=0:P(4)=L:Z=USR(34):Z=USR(32)
14020ifinkey$=""thengoto14020
14090return
14100L=&h6fff:F$(0)="final.sc5":Z=USR(31):P(2)=0:P(3)=0:P(4)=L:Z=USR(34):Z=USR(32)
14120ifinkey$=""thengoto14120
20100return
23000_TURBOOFF
